<style>
    * {
    padding: 0;
    margin: 0;
}
    body {
        
    }

    .container div {

        float: left;
        padding: 0vw;
        border:1px solid #000;
        font-size: 1px;
    }
</style>

<body>
    <div class="container" id="container">
    </div>

    <button id="start" onclick="quickSort(array, 0, 99, -1, 0, 'start')">Quick Sort</button>
    <button onclick="mergeSort(array, 0, 99, 'fuck')">Merge Sort</button>
    <button id="swap" onclick="swap(1,4)">swap</button>
    <p id="test">afdads</p>
</body>

<script>
    function shuffle(array) {
        array.sort(() => Math.random() - 0.5);
    }
    var array = [];

    for (var i = 0; i < 100; i++) {
        array[i] = i + 1;
    }
    shuffle(array);
    console.log(array);
    var container = document.getElementById('container');
    array.forEach (x => {
        var bar = document.createElement('div');
        bar.innerHTML = x;
        bar.id = String(x);
        bar.style.height =  x;
        container.appendChild(bar);
    });
    var li = 0;
    var red = true;

    var index = 0;
    var pivot = array[4];

    var a = -1;

    function swap(arr, i3, j3) {
        var i2 = arr[i3];
        var j2 = arr[j3];

        var iHTML = document.getElementById(String(i2));
 
        iHTML.innerHTML = j2;
        iHTML.style.height =   j2;

        var jHTML = document.getElementById(String(j2));
        jHTML.innerHTML = i2;
        jHTML.style.height = i2;

        iHTML.id = j2;
        jHTML.id = i2;
        
        arr[i3] = j2;
        arr[j3] = i2;
    }

    
var j = 0;
    function quickSort(arr, lo, hi, i, j, state) {
        setTimeout(function() {  

            if (lo <= hi) {

                console.log(state+ ": " + arr[j]);
                var x = arr[j];
                var pivot = arr[hi];
                
                    if (red) {
                        document.getElementById(String(x)).style.background = 'red';
                         red = false;
                     } else {
                         if (arr[j] < pivot) {
                            i += 1;
                             document.getElementById(String(x)).style.background = 'white';
                             red = true;
                             swap(arr, i, j);
                         }
                         document.getElementById(String(x)).style.background = 'white';
                         red = true;
                     }
                
                
    
                       
                if (li == 0) {   
                    li++;         
                    quickSort(arr, lo, hi, i, j, state);
                } else {
                    li = 0;
                    j++;
                    if (j > hi - 1) {
                        i += 1;
                        swap(arr, i, hi);
                        var z = i;
                        i = -1;
                        j = 0;
                        console.log("new");
                        quickSort(arr, lo, z-1,lo-1, lo, 'before');
                        quickSort(arr,z+1, hi, z, z+1, 'after');
                        
                    } else {
                        quickSort(arr,lo, hi, i, j, state);
                    }
                }      
            } else {
                console.log("done");
            }
                          
        }, 5)

    }

    function mergeSort(arr, beg, end, state) {
        if (beg < end) {
            var mid = Math.floor((beg + end) / 2);
            console.log(array);
           mergeSort(arr, beg, mid, "start");

                mergeSort(arr, mid + 1, end, "end");
                    merge(arr, beg, mid, end, 0, 0, beg, state, -1);
        }

    }

    var n1, n2, leftArray = {}, rightArray={};
    li = 0;
    red = true;
    function merge(arr, beg, mid, end, i, j, k, state, step) { 
            if (k <= end && beg < end) {   
                if (step == -1) {
                    for (var ii = 0; ii < mid - beg + 1; ii++) {
                        console.log("Assigning Left: ", arr[beg + ii]);
                        leftArray[ii] = arr[beg + ii];
                    }
        
                    for (var jj = 0; jj < end - mid; jj++) {
                        console.log("Assigning Right: ", arr[mid+1+jj]);
                        rightArray[jj] = arr[mid + 1 + jj];
                    }
                    step++;
                }
                if (step == 0) {
                    console.log(state + " Step 0!");
                    if (i < mid - beg + 1 && j < end - mid) {
                        if (red) {
                            if (leftArray[i] <= rightArray[j]) {
                                //document.getElementById(String(leftArray[i])).style.background = 'red';
                                console.log("swap ", arr[k], leftArray[i]);

                                swap(arr, k, arr.indexOf(leftArray[i]));
                                //arr[k] = leftArray[i];
                                i++;
    
                            } else {
                               //document.getElementById(rightArray[j]).style.background = 'white';
                               console.log("swap ", arr[k], rightArray[j]);
                               swap(arr, k, arr.indexOf(rightArray[j]));
                               // arr[k] = rightArray[j];
                                j++;
                            }
                            k++;
                            red = false;
                        } else {
                            red = true;
                        }
                        
                    } else {
                        step++;
                    }
                }
                else if (step ==1) {
                    console.log("Step 1!");
                    if (i <mid - beg + 1) {
                        console.log("swap ", arr[k], leftArray[i]);
                        swap(arr, k, arr.indexOf(leftArray[i]));
                        //arr[k] = leftArray[i];
                        i++;
                        k++;
                    } else {
                        step++;
                    }
        
                }
                else if (step ==2) {
                    console.log("Step 2!");
                    if ( j < end - mid) {
                        console.log("swap ", arr[k], rightArray[j]);
                        swap(arr, k, arr.indexOf(rightArray[j]));
                        //a[k]=rightArray[j];
                        j++;
                        k++;
                    } else {
                        step = -1;
                    }
                } 
                console.log(state, leftArray);
                console.log(state, rightArray);
                console.log(state, beg, mid, end);
                console.log(state, arr);
                console.log('step', state, step);
                if (li == 0) {
                    li++;
                    console.log(state, "ijk",i,j,k);
                    merge(arr, beg, mid, end, i, j, k, state, step);
                } else {
                    li = 0;
                    merge(arr, beg, mid, end, i, j, k, state, step);
                }
            } 
        


    }
    
</script>